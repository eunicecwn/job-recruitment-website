@model Demo.Models.AccountViewModels.ForgotPasswordViewModel
@{
    ViewData["Title"] = "Forgot Password";
    Layout = null;
}

<link rel="stylesheet" href="~/css/ForgotPasswd.css" />
<link rel="shortcut icon" href="/images/logo.png">

<div class="forgot-password-container">
    <div class="forgot-password-card">
        <div class="card-header">
            <div class="logo-container">
                <img src="/images/logo.png" alt="Company Logo" class="logo-img" />
                <h2>Forgot Password?</h2>
            </div>
            <p>No worries! We'll send you a reset link</p>
        </div>

        <div class="card-body">
            @if (ViewData.ModelState.Values.SelectMany(v => v.Errors).Any())
            {
                <div class="alert alert-danger" role="alert">
                    <strong>Please correct the following errors:</strong>
                    <ul class="mb-0 mt-2">
                        @foreach (var error in ViewData.ModelState.Values.SelectMany(v => v.Errors))
                        {
                            <li>@error.ErrorMessage</li>
                        }
                    </ul>
                </div>
            }

            <div class="help-text">
                <h5>📧 How it works:</h5>
                <p>Enter your email address and we'll send you a secure link to reset your password. The link will expire in 15 minutes for your security.</p>
            </div>

            <form asp-action="ForgotPassword" method="post" id="forgotPasswordForm">
                <div class="form-group">
                    <label asp-for="Email">Email Address</label>
                    <input asp-for="Email" class="form-control" placeholder="Enter your registered email address" autocomplete="email" />
                    <span asp-validation-for="Email" class="text-validation-error"></span>
                </div>

                <div class="recaptcha-container">
                    <div class="g-recaptcha" data-sitekey="@ViewBag.SiteKey" data-callback="onRecaptchaSuccess"></div>
                    <input type="hidden" asp-for="RecaptchaResponse" id="recaptchaResponse" />
                    <span asp-validation-for="RecaptchaResponse" class="text-validation-error"></span>
                </div>

                <button type="submit" class="btn-reset" id="resetButton" disabled>
                    <span id="buttonText">Send Reset Link</span>
                    <span id="loadingText" style="display: none;">
                        <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                        Sending...
                    </span>
                </button>
            </form>

            <div class="security-note">
                <p>
                    <span class="icon">🛡️</span>
                    <strong>Security Notice:</strong> For your protection, we don't reveal whether an email address exists in our system. You'll receive instructions only if the email is registered.
                </p>
            </div>

            <div class="back-to-login">
                <p>Remember your password? <a href="@Url.Action("Login", "Account")">Back to Login</a></p>
            </div>
        </div>
    </div>
</div>

<script src="https://www.google.com/recaptcha/api.js" async defer></script>
<script>
    function onRecaptchaSuccess(token) {
        document.getElementById('recaptchaResponse').value = token;
        document.getElementById('resetButton').disabled = false;
    }

    document.addEventListener('DOMContentLoaded', function() {
        // Auto-focus email field
        const emailField = document.querySelector('input[type="email"]');
        if (emailField) {
            emailField.focus();
        }

        // Form submission handler
        const form = document.getElementById('forgotPasswordForm');
        if (form) {
            form.addEventListener('submit', function() {
                const button = document.getElementById('resetButton');
                const buttonText = document.getElementById('buttonText');
                const loadingText = document.getElementById('loadingText');

                button.disabled = true;
                buttonText.style.display = 'none';
                loadingText.style.display = 'inline';
            });
        }
    });
</script>