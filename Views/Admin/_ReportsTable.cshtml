@model List<JobRecruitment.Models.ViewModels.UnifiedReportViewModel>

@if (Model != null && Model.Any())
{
    <div class="table-responsive">
        <table class="table table-hover">
            <thead class="table-light">
                <tr>
                    <th>TYPE</th>
                    <th>REPORTED ENTITY</th>
                    <th>ROLE</th>
                    <th>REPORT REASON</th>
                    <th>REPORTER</th>
                    <th>DATE</th>
                    <th>STATUS</th>
                    <th>ACTIONS</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var report in Model)
                {
                    <tr>
                        <td>
                            @if (report.ReportType == "User")
                            {
                                <span class="badge bg-success">User Report</span>

                            }
                            else
                            {
                                <span class="badge bg-warning text-dark">Employer Report</span>

                            }
                        </td>
                        <td>
                            @report.ReportedEntityName
                        </td>
                        <td>
                            @if (report.ReportType == "User")
                            {
                                <span class="text-primary">User</span>
                            }
                            else
                            {
                                <span class="text-success">Employer</span>
                            }
                        </td>
                        <td>
                            <span class="text-truncate d-inline-block" style="max-width: 200px;"
                                  title="@report.Reason">
                                @report.Reason
                            </span>
                        </td>
                        <td>
                            @report.ReporterName
                        </td>
                        <td>
                            @report.DateReported.ToString("yyyy-MM-dd")
                        </td>
                        <td>
                            @if (report.IsBlocked)
                            {
                                <span class="badge bg-danger">Blocked</span>
                            }
                            else
                            {
                                <span class="badge bg-success">Active</span>
                            }
                        </td>
                        <td>
                            <div class="btn-group" role="group">
                                <a href="@Url.Action("UserReportDetails", new { id = report.ReportId })"
                                   class="btn btn-sm btn-outline-primary" title="View Details">
                                    <i class="bi bi-eye"></i> Details
                                </a>

                                @if (!report.IsBlocked)
                                {
                                    <button type="button" class="btn btn-sm btn-outline-danger"
                                            onclick="blockEntity('@report.ReportedEntityId', '@report.ReportType')" title="Block">
                                        <i class="bi bi-ban"></i> Block
                                    </button>
                                }
                                else
                                {
                                    <button type="button" class="btn btn-sm btn-outline-success"
                                            onclick="unblockEntity('@report.ReportedEntityId', '@report.ReportType')" title="Unblock">
                                        <i class="bi bi-check-circle"></i> Unblock
                                    </button>
                                }

                                <button type="button" class="btn btn-sm btn-outline-secondary"
                                        onclick="deleteReport('@report.ReportId')" title="Delete">
                                    <i class="bi bi-trash"></i> Delete
                                </button>
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    @if (ViewBag.TotalPages > 1)
    {
        <nav aria-label="Page navigation">
            <ul class="pagination justify-content-center">
                <li class="page-item @(ViewBag.CurrentPage == 1 ? "disabled" : "")">
                    <a class="page-link" href="#" data-page="@(ViewBag.CurrentPage - 1)"
                       @(ViewBag.CurrentPage == 1 ? "tabindex=\"-1\" aria-disabled=\"true\"" : "")>
                        Previous
                    </a>
                </li>

                @{
                    int startPage = Math.Max(1, ViewBag.CurrentPage - 2);
                    int endPage = Math.Min((int)ViewBag.TotalPages, ViewBag.CurrentPage + 2);
                }

                @if (startPage > 1)
                {
                    <li class="page-item">
                        <a class="page-link" href="#" data-page="1">1</a>
                    </li>
                    @if (startPage > 2)
                    {
                        <li class="page-item disabled">
                            <span class="page-link">...</span>
                        </li>
                    }
                }

                @for (int i = startPage; i <= endPage; i++)
                {
                    <li class="page-item @(i == ViewBag.CurrentPage ? "active" : "")">
                        <a class="page-link" href="#" data-page="@i">@i</a>
                    </li>
                }

                @if (endPage < ViewBag.TotalPages)
                {
                    @if (endPage < ViewBag.TotalPages - 1)
                    {
                        <li class="page-item disabled">
                            <span class="page-link">...</span>
                        </li>
                    }
                    <li class="page-item">
                        <a class="page-link" href="#" data-page="@ViewBag.TotalPages">@ViewBag.TotalPages</a>
                    </li>
                }

                <li class="page-item @(ViewBag.CurrentPage == ViewBag.TotalPages ? "disabled" : "")">
                    <a class="page-link" href="#" data-page="@(ViewBag.CurrentPage + 1)"
                       @(ViewBag.CurrentPage == ViewBag.TotalPages ? "tabindex=\"-1\" aria-disabled=\"true\"" : "")>
                        Next
                    </a>
                </li>
            </ul>
        </nav>
    }

    <div class="mt-3">
        <small class="text-muted">
            @{
                int totalReports = ViewBag.TotalReports ?? Model.Count();
                int pageSize = 10;
                int currentPage = ViewBag.CurrentPage ?? 1;
                int startRecord = ((currentPage - 1) * pageSize) + 1;
                int endRecord = Math.Min(currentPage * pageSize, totalReports);
            }
            Showing @startRecord to @endRecord of @totalReports records
        </small>
    </div>
}
else
{
    <div class="text-center py-5">
        <i class="bi bi-inbox fs-1 text-muted mb-3"></i>
        <h5 class="text-muted">No reports found</h5>
        <p class="text-muted">There are no reports matching your criteria.</p>

        @if (!string.IsNullOrEmpty(ViewBag.SearchTerm as string) ||
            !string.IsNullOrEmpty(ViewBag.FilterType as string) ||
            !string.IsNullOrEmpty(ViewBag.FilterStatus as string))
        {
            <button type="button" class="btn btn-outline-primary" onclick="clearFilters()">
                <i class="bi bi-x-circle"></i> Clear Filters
            </button>
        }
    </div>
}

<script>
    function clearFilters() {
        $('#searchTerm').val('');
        $('#filterType').val('');
        $('#filterStatus').val('');
        currentPage = 1;
        loadReports();
    }
</script>