<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>@ViewBag.Title - HireRightPro</title>
	<!-- Google Fonts -->
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
	<!-- Bootstrap Icons -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="/css/app.css">
	<link rel="shortcut icon" href="/images/logo.png">

	<style>
		:root {
			--primary: #4F46E5;
			--primary-light: #6366F1;
			--primary-dark: #4338CA;
			--secondary: #10B981;
			--admin-primary: #DC2626;
			--admin-secondary: #4F46E5;
			--dark: #111827;
			--light: #F9FAFB;
			--gray: #6B7280;
			--light-gray: #E5E7EB;
			--bg-light: #F3F4F6;
			--sidebar-width: 280px;
			--sidebar-collapsed-width: 80px;
		}
		/* Sidebar Styles */
		.sidebar {
			width: var(--sidebar-width);
			min-height: 100vh;
			transition: all 0.3s ease;
			position: fixed;
			left: 0;
			top: 0;
			bottom: 0;
			z-index: 1000;
			overflow-x: hidden;
			overflow-y: auto;
			background-color: white;
			border-right: 1px solid var(--light-gray);
			-ms-overflow-style: none;
			scrollbar-width: none;
		}

			.sidebar::-webkit-scrollbar {
				display: none;
			}

		/* Collapsed State */
		.sidebar-collapsed {
			width: var(--sidebar-collapsed-width);
		}

			.sidebar-collapsed .nav-link-text,
			.sidebar-collapsed .logo-text,
			.sidebar-collapsed .user-info,
			.sidebar-collapsed .nav-section-header {
				display: none !important;
			}

			.sidebar-collapsed .nav-link {
				justify-content: center;
				padding-left: 0;
				padding-right: 0;
				margin: 0.25rem 0;
			}

			.sidebar-collapsed .logo {
				justify-content: center;
			}

			.sidebar-collapsed .avatar {
				margin: 0 auto;
			}

		/* Main Content Adjustment */
		.main-content {
			margin-left: var(--sidebar-width);
			transition: margin-left 0.3s ease;
			min-height: 100vh;
			display: flex;
			flex-direction: column;
		}

		.sidebar-collapsed ~ .main-content {
			margin-left: var(--sidebar-collapsed-width);
		}

		/* General Styles */
		body {
			font-family: 'Inter', sans-serif;
			background-color: var(--bg-light);
			color: var(--dark);
			overflow-x: hidden;
		}

		.nav-link {
			color: var(--gray);
			transition: all 0.2s ease;
			text-decoration: none;
		}

			.nav-link:hover,
			.nav-link.active {
				color: var(--primary);
				background-color: rgba(79, 70, 229, 0.1);
			}

		.topbar {
			position: sticky;
			top: 0;
			z-index: 999;
			background-color: white;
			box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
		}

		/* Admin-specific styling */
		.admin-badge {
			font-size: 0.75rem;
			padding: 2px 8px;
			border-radius: 12px;
			background: var(--admin-primary);
			color: white;
		}

		/* Enhanced User Profile Footer Styles */
		.avatar {
			width: 40px !important;
			height: 40px !important;
			min-width: 40px !important;
			border-radius: 50% !important;
			flex-shrink: 0 !important;
			transition: none !important;
			display: flex !important;
			align-items: center !important;
			justify-content: center !important;
			background-color: var(--admin-primary);
			color: white;
		}

		.user-avatar {
			width: 40px;
			height: 40px;
			border-radius: 50%;
			object-fit: cover;
		}

		/* Avatar Dropdown Styles */
		.avatar-lg {
			width: 80px;
			height: 80px;
			border-radius: 50%;
			background-color: var(--admin-primary);
			color: white;
			display: flex;
			align-items: center;
			justify-content: center;
			margin: 0 auto;
		}

		.dropdown-menu {
			border: 1px solid var(--light-gray);
			border-radius: 10px;
			box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
		}

		.dropdown-toggle::after {
			display: none !important;
		}

		/* Hover effect for dropdown trigger */
		.user-profile-dropdown:hover {
			background-color: rgba(79, 70, 229, 0.1);
			border-radius: 8px;
		}

		/* Dropdown item styling */
		.dropdown-item:hover {
			background-color: rgba(79, 70, 229, 0.1);
			color: var(--primary);
		}

		.dropdown-item i {
			width: 20px;
			text-align: center;
		}

		/* Tooltip styles for collapsed sidebar */
		.nav-item {
			position: relative;
		}

		.nav-link .tooltip {
			display: none;
			position: absolute;
			left: 100%;
			top: 50%;
			transform: translateY(-50%);
			background-color: var(--dark);
			color: white;
			padding: 0.5rem 0.75rem;
			border-radius: 6px;
			font-size: 0.8rem;
			white-space: nowrap;
			z-index: 1001;
			margin-left: 10px;
		}

		.sidebar-collapsed .nav-item:hover .tooltip {
			display: block;
		}

		/* Special positioning for collapsed sidebar dropdown */
		.sidebar-collapsed .user-profile-footer .dropdown-menu {
			position: absolute;
			left: 100%;
			bottom: 0;
			min-width: 250px;
			margin-left: 10px;
		}

		/* Collapsed sidebar AI styles */
		.sidebar-collapsed .ai-assistant-section {
			background: transparent;
			border: none;
			margin: 0.5rem 0;
		}

		.sidebar-collapsed .ai-assistant-header {
			padding: 0;
			justify-content: center;
			pointer-events: none;
		}

		.sidebar-collapsed .ai-assistant-title,
		.sidebar-collapsed .ai-assistant-toggle {
			display: none !important;
		}

		.sidebar-collapsed .ai-assistant-content {
			max-height: none !important;
			opacity: 1 !important;
			padding: 0 !important;
		}

			.sidebar-collapsed .ai-assistant-content.collapsed {
				max-height: none !important;
				opacity: 1 !important;
			}

		.sidebar-collapsed .ai-assistant-content-inner {
			padding: 0;
		}

		.sidebar-collapsed .ai-btn {
			padding: 0.75rem;
			width: 50px;
			height: 50px;
			border-radius: 50%;
			margin: 0 auto;
			gap: 0;
		}

			.sidebar-collapsed .ai-btn i {
				margin: 0;
				font-size: 1.3rem;
			}

		.sidebar-collapsed .ai-btn-text {
			display: none !important;
		}
	</style>
</head>
<body class="bg-gray-50">
	<div class="d-flex">
		<!-- Admin Sidebar -->
		<aside class="sidebar d-flex flex-column p-3">
			<div class="d-flex justify-content-between align-items-center mb-4">
				<a href="/Admin/AdminDashboard" class="logo d-flex align-items-center text-decoration-none">
					<img src="/images/logo.png" alt="Logo" width="36" height="36">
					<span class="logo-text fs-4 fw-bold text-dark ms-2">HireRight<span class="text-primary">Pro</span></span>
				</a>
				<button class="sidebar-collapse-btn btn btn-link p-0 d-none d-lg-block">
					<i class="bi bi-chevron-left"></i>
				</button>
			</div>

			<nav class="flex-grow-1">
				<ul class="nav flex-column gap-1">
					<li class="nav-item">
						<a href="/Admin/AdminDashboard" class="nav-link d-flex align-items-center px-3 py-3 rounded">
							<i class="bi bi-speedometer2 fs-5"></i>
							<span class="nav-link-text ms-3">Dashboard</span>
							<span class="tooltip">Dashboard</span>
						</a>
					</li>
					<li class="nav-item">
						<a href="/Admin/Reports" class="nav-link d-flex align-items-center px-3 py-3 rounded">
							<i class="bi bi-graph-up fs-5"></i>
							<span class="nav-link-text ms-3">View Spams</span>
							<span class="tooltip">View Spams</span>
						</a>
					</li>
					<li class="nav-item">
						<a href="/Admin/JobReports" class="nav-link d-flex align-items-center px-3 py-3 rounded">
							<i class="bi bi-graph-up fs-5"></i>
							<span class="nav-link-text ms-3">View Jobs Reports</span>
							<span class="tooltip">View Jobs Reports</span>
						</a>
					</li>
					<li class="nav-item">
						<a href="/Admin/Payments" class="nav-link d-flex align-items-center px-3 py-3 rounded">
							<i class="bi bi-graph-up fs-5"></i>
							<span class="nav-link-text ms-3">Payments</span>
							<span class="tooltip">Payments</span>
						</a>
					</li>
					<li class="nav-item">
						<a href="/Admin/LockedUsers" class="nav-link d-flex align-items-center px-3 py-3 rounded">
							<i class="fa-solid fa-lock fs-5"></i>
							<span class="nav-link-text ms-3">Locked Users Management</span>
							<span class="tooltip">Locked Users Management</span>
						</a>
					</li>

				</ul>
			</nav>

			<!-- Enhanced User Profile Footer -->
			<div class="user-profile-footer mt-auto pt-4 border-top">
				<div class="dropdown">
					<!-- Clickable Avatar -->
					<div class="user-profile-dropdown d-flex align-items-center px-2 py-2 dropdown-toggle"
						 data-bs-toggle="dropdown"
						 aria-expanded="false"
						 style="cursor: pointer">

						<!-- Avatar with conditional rendering -->
						@if (!string.IsNullOrEmpty(ViewBag.ProfilePhotoFileName as string))
						{
							<img src="/uploads/profilepics/@ViewBag.ProfilePhotoFileName" alt="Profile" class="avatar">
						}
						else
						{
							<div class="avatar">
								<i class="bi bi-shield-check fs-5"></i>
							</div>
						}

						<!-- User Info (hidden when collapsed) -->
						<div class="user-info ms-3">
							<div class="d-flex align-items-center gap-2">
								<div class="fw-medium">@ViewBag.AdminName</div>
							</div>
							<small class="text-muted d-block text-truncate" style="max-width: 150px;">@ViewBag.AdminEmail</small>
						</div>
					</div>

					<!-- Enhanced Dropdown Menu -->
					<ul class="dropdown-menu dropdown-menu-end shadow-sm p-2" style="width: 250px">
						<!-- Profile Header -->
						<li class="p-3 text-center border-bottom">
							<div class="avatar-lg mb-2">
								@if (!string.IsNullOrEmpty(ViewBag.ProfilePhotoFileName as string))
								{
									<img src="/uploads/profilepics/@ViewBag.ProfilePhotoFileName" alt="Profile" style="width: 80px; height: 80px; border-radius: 50%; object-fit: cover;">
								}
								else
								{
									<i class="bi bi-shield-check fs-1"></i>
								}
							</div>
							<div class="d-flex align-items-center justify-content-center gap-2 mb-1">
								<h6 class="mb-0">@ViewBag.AdminName</h6>
							</div>
							<small class="text-muted">@ViewBag.AdminEmail</small>
						</li>

						<!-- Menu Items -->
						<li><a class="dropdown-item" href="/Admin/AdminProfile"><i class="bi bi-person-gear me-2"></i>Admin Profile</a></li>
						<li><a class="dropdown-item" href="/Account/ChangePassword"><i class="bi bi-key me-2"></i>Change Password</a></li>
						<li><hr class="dropdown-divider"></li>
						<li>
							<form asp-controller="Account" asp-action="Logout" method="post" class="d-inline w-100">
								<button type="submit" class="dropdown-item text-danger">
									<i class="bi bi-box-arrow-right me-2"></i>Logout
								</button>
							</form>
						</li>
					</ul>
				</div>
			</div>
		</aside>

		<!-- Main Content -->
		<div class="main-content flex-grow-1 d-flex flex-column">
			<!-- Admin Topbar -->
			<header class="bg-white shadow-sm px-4 py-3 d-flex justify-content-between align-items-center topbar">
				<div class="d-flex align-items-center gap-3">
					<button class="btn btn-sm btn-outline-secondary d-lg-none" id="sidebarToggle">
						<i class="bi bi-list"></i>
					</button>
				</div>
			</header>

			<!-- Page Content -->
			<main class="flex-grow-1 p-4 bg-gray-50">
				<div class="container-fluid">
					<!-- Alerts Section -->
					@if (TempData["Success"] != null)
					{
						<div class="alert alert-success alert-dismissible fade show" role="alert">
							<i class="bi bi-check-circle me-2"></i>@TempData["Success"]
							<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
						</div>
					}

					@if (TempData["Error"] != null)
					{
						<div class="alert alert-danger alert-dismissible fade show" role="alert">
							<i class="bi bi-exclamation-triangle me-2"></i>@TempData["Error"]
							<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
						</div>
					}

					@if (TempData["Info"] != null)
					{
						<div class="alert alert-info alert-dismissible fade show" role="alert">
							<i class="bi bi-info-circle me-2"></i>@TempData["Info"]
							<button type="number" class="btn-close" data-bs-dismiss="alert"></button>
						</div>
					}

					<!-- Page Header -->
					<div class="d-flex justify-content-between align-items-center mb-4">
						<div>
							<h1 class="h3 fw-bold text-dark m-0 d-flex align-items-center gap-2">
								<i class="bi bi-shield-check text-primary"></i>
								@ViewBag.Title
							</h1>
							<small class="text-muted">Administrative Control Panel</small>
						</div>
						<nav aria-label="breadcrumb">
							<ol class="breadcrumb">
								<li class="breadcrumb-item"><a href="/Admin/AdminDashboard">Admin</a></li>
								<li class="breadcrumb-item active" aria-current="page">@ViewBag.Title</li>
							</ol>
						</nav>
					</div>

					@RenderBody()
				</div>
			</main>

			<!-- Footer -->
			<footer class="text-center text-muted py-3 border-top small bg-white">
				<div class="container-fluid">
					<div class="row">
						<div class="col-12">
							<span>© @DateTime.Today.Year HireRightPro. All rights reserved. Developed by MEALY Team</span>
						</div>
					</div>
				</div>
			</footer>

		</div>
	</div>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
	<script>
		// AI Assistant Toggle
		let aiAssistantCollapsed = false;

		function toggleAIAssistant() {
			const sidebar = document.querySelector('.sidebar');
			if (sidebar && sidebar.classList.contains('sidebar-collapsed')) {
				return;
			}

			const content = document.getElementById('aiAssistantContent');
			const toggleBtn = document.getElementById('aiToggleBtn');
			const icon = toggleBtn.querySelector('i');

			aiAssistantCollapsed = !aiAssistantCollapsed;

			if (aiAssistantCollapsed) {
				content.classList.add('collapsed');
				icon.classList.remove('bi-chevron-up');
				icon.classList.add('bi-chevron-down');
				toggleBtn.classList.add('collapsed');
			} else {
				content.classList.remove('collapsed');
				icon.classList.remove('bi-chevron-down');
				icon.classList.add('bi-chevron-up');
				toggleBtn.classList.remove('collapsed');
			}

			localStorage.setItem('aiAssistantCollapsed', aiAssistantCollapsed);
		}

		function openAIHelper() {
			// Simple alert for now - you can replace this with your AI functionality
			alert('AI Assistant clicked! You can replace this with your AI helper functionality.');
		}

		// Sidebar functionality - Keep your working backup logic
		const sidebar = document.querySelector('.sidebar');
		const sidebarToggle = document.getElementById('sidebarToggle');
		const collapseBtn = document.querySelector('.sidebar-collapse-btn');

		// Mobile toggle
		if (sidebarToggle) {
			sidebarToggle.addEventListener('click', function() {
				sidebar.classList.toggle('show');
			});
		}

		// Desktop collapse/expand
		if (collapseBtn) {
			collapseBtn.addEventListener('click', function() {
				sidebar.classList.toggle('sidebar-collapsed');
				const icon = this.querySelector('i');
				icon.classList.toggle('bi-chevron-left');
				icon.classList.toggle('bi-chevron-right');

				// Handle AI assistant when sidebar collapses
				const aiContent = document.getElementById('aiAssistantContent');
				if (sidebar.classList.contains('sidebar-collapsed')) {
					aiContent.classList.remove('collapsed');
				} else {
					const savedAiState = localStorage.getItem('aiAssistantCollapsed');
					if (savedAiState === 'true') {
						aiContent.classList.add('collapsed');
						const toggleBtn = document.getElementById('aiToggleBtn');
						const toggleIcon = toggleBtn.querySelector('i');
						toggleIcon.classList.remove('bi-chevron-up');
						toggleIcon.classList.add('bi-chevron-down');
						toggleBtn.classList.add('collapsed');
						aiAssistantCollapsed = true;
					}
				}
			});
		}

		// Close sidebar when clicking outside on mobile
		document.addEventListener('click', function(event) {
			if (window.innerWidth <= 992 &&
				sidebar.classList.contains('show') &&
				!sidebar.contains(event.target) &&
				event.target !== sidebarToggle &&
				!sidebarToggle.contains(event.target)) {
				sidebar.classList.remove('show');
			}
		});

		// Set active state for navigation links
		function setActiveNavLink() {
			const currentPath = window.location.pathname.toLowerCase();
			const navLinks = document.querySelectorAll('.nav-link');

			navLinks.forEach(link => {
				const linkPath = link.getAttribute('href').toLowerCase();
				link.classList.remove('active');

				if (currentPath === linkPath ||
					(currentPath.startsWith(linkPath) && linkPath !== '/')) {
					link.classList.add('active');
				}
			});
		}

		// Initialize when DOM is ready
		document.addEventListener('DOMContentLoaded', function() {
			setActiveNavLink();

			// Load sidebar state
			const isCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
			if (isCollapsed && collapseBtn) {
				sidebar.classList.add('sidebar-collapsed');
				const icon = collapseBtn.querySelector('i');
				icon.classList.remove('bi-chevron-left');
				icon.classList.add('bi-chevron-right');
			}

			// Load AI Assistant state only if sidebar is not collapsed
			if (!isCollapsed) {
				const savedAiState = localStorage.getItem('aiAssistantCollapsed');
				if (savedAiState === 'true') {
					toggleAIAssistant();
				}
			}

			// Save state when collapsing
			if (collapseBtn) {
				collapseBtn.addEventListener('click', function() {
					localStorage.setItem('sidebarCollapsed', sidebar.classList.contains('sidebar-collapsed'));
				});
			}
		});

		// Auto-dismiss alerts after 5 seconds
		setTimeout(function() {
			const alerts = document.querySelectorAll('.alert');
			alerts.forEach(alert => {
				if (bootstrap && bootstrap.Alert) {
					const bsAlert = new bootstrap.Alert(alert);
					bsAlert.close();
				}
			});
		}, 5000);

		// System status check
		function updateSystemStatus() {
			console.log('System status: Online');
		}

		setInterval(updateSystemStatus, 30000);
	</script>

	<!-- Your existing scripts -->
	<script src="/js/jquery.min.js"></script>
	<script src="/js/jquery.unobtrusive-ajax.min.js"></script>
	<script src="/js/jquery.validate.min.js"></script>
	<script src="/js/jquery.validate.unobtrusive.min.js"></script>

	<script src="/js/jobPostFormCounters.js"></script>

	@RenderSection("Scripts", required: false)
</body>
</html>